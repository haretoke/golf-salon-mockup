<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ユーザー管理 - Golf Salon Admin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&family=Noto+Serif+JP:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script>
      // Tailwind v4 設定の動的読み込み
      async function loadTailwindConfig() {
        try {
          const response = await fetch("css/tailwind-v4-config.css");
          const cssContent = await response.text();

          // <style type="text/tailwindcss">タグを作成
          const styleElement = document.createElement("style");
          styleElement.type = "text/tailwindcss";
          styleElement.textContent = cssContent;

          // headに挿入
          document.head.appendChild(styleElement);
        } catch (error) {
          console.error("Tailwind設定の読み込みに失敗しました:", error);
        }
      }

      // DOMContentLoadedより前に実行
      loadTailwindConfig();
    </script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="js/data-loader.js"></script>
    <script src="js/utils/user-status.js"></script>
    <script src="js/admin-users.js"></script>
  </head>
  <body class="bg-gray-50">
    <div class="flex h-screen relative">
      <!-- サイドバー -->
      <aside
        class="w-60 text-white flex flex-col fixed lg:relative h-full z-40 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 bg-green-gradient"
        id="sidebar"
      >
        <div class="flex-1 flex flex-col">
          <div class="px-6 pt-8 pb-6 border-b border-white/10">
            <div class="flex items-center justify-between">
              <h1 class="text-2xl font-bold">Golf Salon</h1>
              <span
                class="text-xs px-3 py-1 rounded font-semibold text-dark-green bg-gold-gradient"
                >ADMIN</span
              >
            </div>
          </div>

          <nav class="flex-1 py-4">
            <a
              href="admin-users.html"
              class="flex items-center gap-3 px-6 py-3.5 bg-white/15 border-l-4 border-yellow-500 text-white"
            >
              <i data-lucide="users" class="w-5 h-5"></i>
              <span>ユーザー管理</span>
            </a>
            <a
              href="admin-contents.html"
              class="flex items-center gap-3 px-6 py-3.5 text-white/80 hover:bg-white/10 hover:text-white border-l-4 border-transparent hover:border-yellow-500 transition-all"
            >
              <i data-lucide="file-text" class="w-5 h-5"></i>
              <span>コンテンツ管理</span>
            </a>
            <a
              href="admin-emails.html"
              class="flex items-center gap-3 px-6 py-3.5 text-white/80 hover:bg-white/10 hover:text-white border-l-4 border-transparent hover:border-yellow-500 transition-all"
            >
              <i data-lucide="mail" class="w-5 h-5"></i>
              <span>メール管理</span>
            </a>
            <a
              href="admin-settings.html"
              class="flex items-center gap-3 px-6 py-3.5 text-white/80 hover:bg-white/10 hover:text-white border-l-4 border-transparent hover:border-yellow-500 transition-all"
            >
              <i data-lucide="settings" class="w-5 h-5"></i>
              <span>設定</span>
            </a>
          </nav>
        </div>

        <div class="px-6 py-6 border-t border-white/10">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div
                class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center"
              >
                <i data-lucide="user" class="w-5 h-5"></i>
              </div>
              <div>
                <div class="text-sm font-medium">管理者</div>
                <div class="text-xs text-gray-400">admin@golfsalon.jp</div>
              </div>
            </div>
            <button
              class="text-white hover:text-gray-300 p-2 rounded-lg hover:bg-white/10"
              title="ログアウト"
            >
              <i data-lucide="log-out" class="w-5 h-5"></i>
            </button>
          </div>
        </div>
      </aside>

      <!-- サイドバーオーバーレイ -->
      <div
        class="fixed inset-0 bg-black/50 z-30 lg:hidden hidden"
        id="sidebarOverlay"
        onclick="toggleSidebar()"
      ></div>

      <!-- メインコンテンツ -->
      <main class="flex-1 overflow-y-auto">
        <!-- ヘッダー -->
        <header
          class="bg-white p-4 lg:py-6 lg:px-8 shadow-xs border-b sticky top-0 z-20 flex justify-between items-center flex-col lg:flex-row gap-4 lg:gap-0"
        >
          <div class="flex items-center gap-4 w-full">
            <button
              class="lg:hidden p-2 hover:bg-gray-100 rounded-lg"
              onclick="toggleSidebar()"
            >
              <i data-lucide="menu" class="w-5 h-5"></i>
            </button>
            <h2 class="text-xl lg:text-2xl font-bold text-dark-green">
              ユーザー管理
            </h2>
          </div>
          <div
            class="flex items-center gap-4 shrink-0 w-full md:w-auto justify-between"
          >
            <div class="relative flex-1">
              <input
                type="text"
                placeholder="ユーザーを検索..."
                class="w-full pl-10 pr-7 py-2 border rounded-lg focus:outline-none focus:shadow focus:ring focus:ring-primary-green"
                id="searchInput"
              />
              <i
                data-lucide="search"
                class="w-5 h-5 absolute left-3 top-2.5 text-gray-400"
              ></i>
              <button
                type="button"
                class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
                id="searchClear"
                onclick="clearSearch()"
                aria-label="検索をクリア"
              >
                ×
              </button>
            </div>
          </div>
        </header>

        <!-- コンテンツ -->
        <div class="p-4 lg:p-8">
          <!-- フィルター -->
          <div class="bg-white rounded-lg shadow p-4 mb-6">
            <div class="flex flex-wrap gap-4">
              <div class="flex-1 min-w-[200px]">
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >ステータス</label
                >
                <select
                  id="statusFilter"
                  data-filter="status"
                  class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-primary-green"
                >
                  <option value="all">すべて</option>
                  <option value="pending-verification">認証待ち</option>
                  <option value="verification-expired">認証期限切れ</option>
                  <option value="verified-no-payment">決済未完了</option>
                  <option value="payment-suspended">利用停止中</option>
                  <option value="active">アクティブ</option>
                  <option value="payment-failed">決済失敗</option>
                  <option value="auto-canceled">失効</option>
                  <option value="withdrawal-pending">退会申請中</option>
                  <option value="canceled">退会済み</option>
                  <option value="suspended">停止中</option>
                  <option value="expired">期限切れ</option>
                </select>
              </div>
              <div class="flex-1 min-w-[200px]">
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >プラン</label
                >
                <select
                  id="planFilter"
                  data-filter="plan"
                  class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-primary-green"
                >
                  <option value="all">すべて</option>
                  <option value="standard">スタンダード</option>
                  <option value="gold">ゴールド</option>
                  <option value="platinum">プラチナ</option>
                </select>
              </div>
              <div class="flex-1 min-w-[200px]">
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >決済状況</label
                >
                <select
                  id="paymentFilter"
                  data-filter="payment"
                  class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value="all">すべて</option>
                  <option value="success">成功</option>
                  <option value="failed">失敗</option>
                </select>
              </div>
            </div>
          </div>

          <!-- ユーザーテーブル -->
          <div class="bg-white rounded-lg shadow overflow-hidden">
            <div class="overflow-x-auto">
              <table id="users-table" class="w-full min-w-[800px]">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      ユーザー
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      プラン
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      ステータス
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      登録日
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      決済状況
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      退会予定日
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      操作
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <!-- ユーザーデータはJavaScriptで動的に生成されます -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- プラン分布とアラート -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6 mt-8">
            <!-- プラン分布 -->
            <div class="bg-white rounded-lg shadow p-6">
              <h3
                class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"
              >
                <i data-lucide="pie-chart" class="w-5 h-5"></i>
                プラン分布
              </h3>
              <div class="space-y-4">
                <div
                  class="flex items-center justify-between p-4 bg-gray-50 rounded-lg"
                >
                  <div>
                    <p class="font-medium text-gray-800">スタンダード</p>
                    <p class="text-sm text-gray-600">¥2,200/月</p>
                  </div>
                  <div class="text-right">
                    <p
                      class="text-2xl font-bold text-gray-800"
                      data-stat="standard-users"
                    >
                      0名
                    </p>
                    <p
                      class="text-sm text-gray-600"
                      data-stat="standard-percentage"
                    >
                      0%
                    </p>
                  </div>
                </div>
                <div
                  class="flex items-center justify-between p-4 bg-yellow-50 rounded-lg"
                >
                  <div>
                    <p class="font-medium text-gray-800">ゴールド</p>
                    <p class="text-sm text-gray-600">¥6,600/月</p>
                  </div>
                  <div class="text-right">
                    <p
                      class="text-2xl font-bold text-gray-800"
                      data-stat="gold-users"
                    >
                      0名
                    </p>
                    <p
                      class="text-sm text-gray-600"
                      data-stat="gold-percentage"
                    >
                      0%
                    </p>
                  </div>
                </div>
                <div
                  class="flex items-center justify-between p-4 bg-purple-50 rounded-lg"
                >
                  <div>
                    <p class="font-medium text-gray-800">プラチナ</p>
                    <p class="text-sm text-gray-600">¥9,900/月</p>
                  </div>
                  <div class="text-right">
                    <p
                      class="text-2xl font-bold text-gray-800"
                      data-stat="platinum-users"
                    >
                      0名
                    </p>
                    <p
                      class="text-sm text-gray-600"
                      data-stat="platinum-percentage"
                    >
                      0%
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- アラート -->
            <div class="bg-white rounded-lg shadow p-6">
              <h3
                class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"
              >
                <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                アラート
              </h3>
              <div class="space-y-4">
                <div class="flex items-start gap-3 p-4 bg-red-50 rounded-lg">
                  <div class="p-2 bg-red-100 rounded-lg">
                    <i
                      data-lucide="credit-card"
                      class="w-5 h-5 text-red-600"
                    ></i>
                  </div>
                  <div class="flex-1">
                    <h4 class="font-medium text-gray-800">決済失敗</h4>
                    <p class="text-sm text-gray-600 mt-1">
                      鈴木 健一さんの決済が失敗しました
                    </p>
                    <p class="text-xs text-gray-500 mt-2">2024/07/15</p>
                  </div>
                </div>
                <div class="flex items-start gap-3 p-4 bg-blue-50 rounded-lg">
                  <div class="p-2 bg-blue-100 rounded-lg">
                    <i data-lucide="user-x" class="w-5 h-5 text-blue-600"></i>
                  </div>
                  <div class="flex-1">
                    <h4 class="font-medium text-gray-800">
                      サブスクリプション解約
                    </h4>
                    <p class="text-sm text-gray-600 mt-1">
                      鈴木 健一さんがサブスクリプションを解約
                    </p>
                    <p class="text-xs text-gray-500 mt-2">2024/07/15</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </body>
</html>
