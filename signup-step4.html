<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>会員登録 - Step 4 | Golf Salon</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&family=Noto+Serif+JP:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script>
      async function loadTailwindConfig() {
        try {
          const response = await fetch("css/tailwind-v4-config.css");
          const cssContent = await response.text();

          const styleElement = document.createElement("style");
          styleElement.type = "text/tailwindcss";
          styleElement.textContent = cssContent;

          document.head.appendChild(styleElement);
        } catch (error) {
          console.error("Tailwind設定の読み込みに失敗しました:", error);
        }
      }

      loadTailwindConfig();
    </script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="js/utils/signup-flow.js"></script>
  </head>
  <body
    class="bg-gradient-to-b from-white via-gray-100 to-gray-light min-h-screen"
  >
    <div
      class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8"
    >
      <div class="max-w-4xl w-full space-y-8">
        <!-- ヘッダー -->
        <div class="text-center">
          <div
            class="mx-auto h-12 w-12 bg-green-gradient rounded-full flex items-center justify-center"
          >
            <i data-lucide="circle-dot" class="w-6 h-6 text-white"></i>
          </div>
          <h1 class="mt-6 text-3xl font-bold text-gray-900">Golf Salon</h1>
          <p class="mt-2 text-sm text-gray-600">
            ゴルフ上達のための特別な学習空間
          </p>
        </div>

        <!-- プログレスバー -->
        <div class="flex items-center justify-center mb-8 px-2">
          <div
            class="flex items-center space-x-1 sm:space-x-2 overflow-x-auto max-w-full"
          >
            <!-- Step 1: Completed -->
            <div class="flex items-center">
              <div
                class="w-8 h-8 bg-dark-green text-white rounded-full flex items-center justify-center text-xs font-medium"
              >
                <i data-lucide="check" class="w-4 h-4"></i>
              </div>
              <span
                class="ml-1 text-xs font-medium text-gray-600 hidden sm:inline"
                >メール</span
              >
            </div>

            <div class="w-10 h-1 bg-dark-green rounded"></div>

            <!-- Step 2: Completed -->
            <div class="flex items-center">
              <div
                class="w-8 h-8 bg-dark-green text-white rounded-full flex items-center justify-center text-xs font-medium"
              >
                <i data-lucide="check" class="w-4 h-4"></i>
              </div>
              <span
                class="ml-1 text-xs font-medium text-gray-600 hidden sm:inline"
                >認証</span
              >
            </div>

            <div class="w-10 h-1 bg-dark-green rounded"></div>

            <!-- Step 3: Completed -->
            <div class="flex items-center">
              <div
                class="w-8 h-8 bg-dark-green text-white rounded-full flex items-center justify-center text-xs font-medium"
              >
                <i data-lucide="check" class="w-4 h-4"></i>
              </div>
              <span
                class="ml-1 text-xs font-medium text-gray-600 hidden sm:inline"
                >基本情報</span
              >
            </div>

            <div class="w-10 h-1 bg-primary-green rounded"></div>

            <!-- Step 4: Active -->
            <div class="flex items-center">
              <div
                class="w-8 h-8 bg-primary-green text-white rounded-full flex items-center justify-center text-xs font-medium"
              >
                4
              </div>
              <span
                class="ml-1 text-xs font-medium text-primary-600 hidden sm:inline"
                >プラン</span
              >
            </div>

            <div class="w-10 h-1 bg-gray-200 rounded"></div>

            <!-- Step 5: Inactive -->
            <div class="flex items-center">
              <div
                class="w-8 h-8 bg-gray-200 text-gray-400 rounded-full flex items-center justify-center text-xs font-medium"
              >
                5
              </div>
              <span
                class="ml-1 text-xs font-medium text-gray-400 hidden sm:inline"
                >支払い</span
              >
            </div>
          </div>
        </div>

        <!-- メインコンテンツ -->
        <div class="bg-white rounded-xl shadow-lg p-8">
          <div class="space-y-8">
            <div class="text-center">
              <h2 class="text-2xl font-bold text-gray-900 mb-2">
                プランを選択してください
              </h2>
              <p class="text-sm text-gray-600">
                あなたに最適なプランを選んで、ゴルフ上達の旅を始めましょう
              </p>
            </div>

            <!-- エラー表示エリア -->
            <div
              id="error-message"
              class="hidden bg-red-50 border border-red-200 rounded-lg p-4"
            >
              <div class="flex items-center">
                <i
                  data-lucide="alert-circle"
                  class="w-5 h-5 text-red-600 mr-3"
                ></i>
                <div class="flex-1">
                  <p class="text-sm text-red-800" id="error-text"></p>
                </div>
              </div>
            </div>

            <!-- プラン選択フォーム -->
            <form id="plan-selection-form" class="space-y-8">
              <!-- プラン選択 -->
              <div class="w-full mb-8">
                <h3
                  class="text-center mb-6 text-lg font-semibold text-dark-green"
                >
                  プランを選択
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <!-- スタンダードプラン -->
                  <div
                    class="plan-card plan-standard rounded-lg p-6 text-center transition-all duration-300 relative cursor-pointer border-2 border-gray-medium bg-white opacity-70 hover:border-primary-green hover:-translate-y-0.5 hover:shadow-md"
                  >
                    <div
                      class="selected-badge absolute -top-2.5 left-1/2 transform -translate-x-1/2 bg-primary-green text-white px-4 py-1 rounded text-xs font-semibold shadow-[0_2px_8px_rgba(44,85,48,0.3)] hidden z-10"
                    >
                      選択中
                    </div>
                    <h4
                      class="mb-4 font-bold text-lg text-dark-green bg-standard-bg rounded px-4 py-2"
                    >
                      スタンダード
                    </h4>
                    <div class="mb-4">
                      <span class="text-2xl font-bold text-primary-green"
                        >¥2,200</span
                      >
                      <span class="text-base text-gray-dark">/月</span>
                    </div>
                    <ul class="space-y-1 text-sm text-gray-dark">
                      <li class="py-1">✓ 動画・画像・つぶやき閲覧</li>
                    </ul>
                  </div>

                  <!-- ゴールドプラン -->
                  <div
                    class="plan-card plan-gold active rounded-lg p-6 text-center transition-all duration-300 relative cursor-pointer border-[3px] border-gold bg-white shadow-[0_6px_20px_rgba(212,175,55,0.4),0_0_0_6px_rgba(212,175,55,0.15)] -translate-y-1 scale-105 hover:-translate-y-1 hover:scale-105"
                  >
                    <div
                      class="recommended-badge absolute -top-2.5 left-1/2 transform -translate-x-1/2 bg-gold-gradient text-white px-4 py-1 rounded text-xs font-semibold"
                    >
                      おすすめ
                    </div>
                    <div
                      class="selected-badge absolute -top-2.5 left-1/2 transform -translate-x-1/2 bg-gold text-white px-4 py-1 rounded text-xs font-semibold shadow-[0_2px_8px_rgba(212,175,55,0.3)] hidden z-10"
                    >
                      選択中
                    </div>
                    <h4
                      class="mb-4 font-bold text-lg text-white bg-gold-gradient rounded px-4 py-2"
                    >
                      ゴールド
                    </h4>
                    <div class="mb-4">
                      <span class="text-2xl font-bold text-gold">¥6,600</span>
                      <span class="text-base text-gray-dark">/月</span>
                    </div>
                    <ul class="space-y-1 text-sm text-gray-dark">
                      <li class="py-1">✓ 動画・画像・つぶやき閲覧</li>
                      <li class="py-1">✓ オンラインレッスン月1回</li>
                    </ul>
                  </div>

                  <!-- プラチナプラン -->
                  <div
                    class="plan-card plan-platinum rounded-lg p-6 text-center transition-all duration-300 relative cursor-pointer border border-slate-500 bg-platinum-gradient opacity-70 hover:border-primary-green hover:-translate-y-0.5 hover:shadow-md animate-[platinumShine_10s_ease-in-out_infinite] bg-[length:200%_200%]"
                  >
                    <div
                      class="selected-badge absolute -top-2.5 left-1/2 transform -translate-x-1/2 bg-slate-500 text-white px-4 py-1 rounded text-xs font-semibold shadow-[0_2px_8px_rgba(113,128,150,0.3)] hidden z-10"
                    >
                      選択中
                    </div>
                    <h4
                      class="mb-4 font-bold text-lg text-white bg-platinum-gradient-dark rounded px-4 py-2 animate-[platinumShineDark_10s_ease-in-out_infinite] bg-[length:200%_200%] overflow-hidden"
                    >
                      プラチナ
                    </h4>
                    <div class="mb-4">
                      <span class="text-2xl font-bold text-slate-600"
                        >¥9,900</span
                      >
                      <span class="text-base text-gray-dark">/月</span>
                    </div>
                    <ul class="space-y-1 text-sm text-gray-dark">
                      <li class="py-1">✓ 動画・画像・つぶやき閲覧</li>
                      <li class="py-1">✓ オンラインレッスン月2回</li>
                    </ul>
                  </div>
                </div>
              </div>

              <!-- 支払い設定へ進むボタン -->
              <button
                type="submit"
                id="register-btn"
                class="w-full bg-gold-gradient text-white py-3 px-4 rounded-lg font-medium hover:bg-dark-gold focus:outline-none focus:ring-2 focus:ring-gold focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <span class="flex items-center justify-center">
                  <span id="register-btn-text">支払い設定へ進む</span>
                  <div id="register-loading-spinner" class="hidden ml-2">
                    <svg
                      class="animate-spin h-4 w-4 text-white"
                      viewBox="0 0 24 24"
                    >
                      <circle
                        class="opacity-25"
                        cx="12"
                        cy="12"
                        r="10"
                        stroke="currentColor"
                        stroke-width="4"
                      ></circle>
                      <path
                        class="opacity-75"
                        fill="currentColor"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"
                      ></path>
                    </svg>
                  </div>
                </span>
              </button>

              <!-- セキュリティ情報 -->
              <div class="text-center space-y-2">
                <p
                  class="text-xs text-gray-500 flex items-center justify-center"
                >
                  <i
                    data-lucide="shield-check"
                    class="w-4 h-4 mr-2 text-primary-green"
                  ></i>
                  SSL暗号化通信で安全に保護されています
                </p>
                <p
                  class="text-xs text-gray-500 flex items-center justify-center"
                >
                  <i
                    data-lucide="credit-card"
                    class="w-4 h-4 mr-2 text-primary-green"
                  ></i>
                  安全な決済システムで処理されます
                </p>
              </div>
            </form>
          </div>
        </div>

        <!-- 戻るリンク -->
        <div class="text-center">
          <a
            href="signup-step3.html"
            class="text-sm text-gray-500 hover:text-gray-700"
          >
            <i data-lucide="arrow-left" class="w-4 h-4 inline mr-1"></i>
            基本情報に戻る
          </a>
        </div>
      </div>
    </div>

    <script>
      // ページ読み込み時の初期化
      document.addEventListener("DOMContentLoaded", () => {
        if (window.lucide) {
          lucide.createIcons();
        }

        // プラン選択フォームの初期化は下記で実行

        // フォーム送信処理
        const form = document.getElementById("plan-selection-form");
        if (form) {
          form.addEventListener("submit", (e) => {
            e.preventDefault();

            // 選択されたプランを取得
            const selectedPlan = document.querySelector(".plan-card.active");
            const planType = selectedPlan
              ? selectedPlan.classList.contains("plan-standard")
                ? "standard"
                : selectedPlan.classList.contains("plan-gold")
                ? "gold"
                : "platinum"
              : "gold";

            // プラン情報を詳細データとして保存
            const planData = {
              type: planType,
              name:
                planType === "standard"
                  ? "スタンダードプラン"
                  : planType === "gold"
                  ? "ゴールドプラン"
                  : "プラチナプラン",
              price:
                planType === "standard"
                  ? 2200
                  : planType === "gold"
                  ? 6600
                  : 9900,
              timestamp: new Date().toISOString(),
            };

            // 選択プランデータを保存
            localStorage.setItem("selectedPlan", JSON.stringify(planData));

            // Step5（支払い設定）へ遷移
            window.location.href = "signup-step5.html";
          });
        }

        // プラン選択の制御
        initPlanSelection();
      });

      // プラン選択の制御
      function initPlanSelection() {
        const planCards = document.querySelectorAll(".plan-card");
        const registerBtn = document.getElementById("register-btn");
        const registerBtnText = document.getElementById("register-btn-text");

        planCards.forEach((card) => {
          card.addEventListener("click", () => {
            // すべてのカードをリセット
            planCards.forEach((c) => {
              c.classList.remove("active");

              // スタンダードプランのリセット
              if (c.classList.contains("plan-standard")) {
                c.className =
                  "plan-card plan-standard rounded-lg p-6 text-center transition-all duration-300 relative cursor-pointer border-2 border-gray-medium bg-white opacity-70 hover:border-primary-green hover:-translate-y-0.5 hover:shadow-md";
                const selectedBadge = c.querySelector(".selected-badge");
                if (selectedBadge) selectedBadge.classList.add("hidden");
              }
              // ゴールドプランのリセット
              else if (c.classList.contains("plan-gold")) {
                c.className =
                  "plan-card plan-gold rounded-lg p-6 text-center transition-all duration-300 relative cursor-pointer border-2 border-gold bg-white opacity-70 hover:border-primary-green hover:-translate-y-0.5 hover:shadow-md shadow-[0_4px_15px_rgba(212,175,55,0.3),0_0_0_4px_rgba(212,175,55,0.1)]";
                const recommendedBadge = c.querySelector(".recommended-badge");
                const selectedBadge = c.querySelector(".selected-badge");
                if (recommendedBadge)
                  recommendedBadge.classList.remove("hidden");
                if (selectedBadge) selectedBadge.classList.add("hidden");
              }
              // プラチナプランのリセット
              else if (c.classList.contains("plan-platinum")) {
                c.className =
                  "plan-card plan-platinum rounded-lg p-6 text-center transition-all duration-300 relative cursor-pointer border border-slate-500 bg-platinum-gradient opacity-70 hover:border-primary-green hover:-translate-y-0.5 hover:shadow-md animate-[platinumShine_10s_ease-in-out_infinite] bg-[length:200%_200%]";
                const selectedBadge = c.querySelector(".selected-badge");
                if (selectedBadge) selectedBadge.classList.add("hidden");
              }
            });

            // 選択されたカードをアクティブに
            card.classList.add("active");

            // プラン別のアクティブスタイル適用とボタンテキスト更新
            if (card.classList.contains("plan-standard")) {
              card.className =
                "plan-card plan-standard active rounded-lg p-6 text-center transition-all duration-300 relative cursor-pointer border-[3px] border-primary-green bg-white shadow-[0_6px_20px_rgba(44,85,48,0.4),0_0_0_6px_rgba(44,85,48,0.15)] -translate-y-1 scale-105 hover:-translate-y-1 hover:scale-105";
              const selectedBadge = card.querySelector(".selected-badge");
              if (selectedBadge) selectedBadge.classList.remove("hidden");
              registerBtn.className =
                "w-full bg-green-gradient text-white py-3 px-4 rounded-lg font-medium hover:bg-primary-dark-green focus:outline-none focus:ring-2 focus:ring-primary-green focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed";
            } else if (card.classList.contains("plan-gold")) {
              card.className =
                "plan-card plan-gold active rounded-lg p-6 text-center transition-all duration-300 relative cursor-pointer border-[3px] border-gold bg-white shadow-[0_6px_20px_rgba(212,175,55,0.4),0_0_0_6px_rgba(212,175,55,0.15)] -translate-y-1 scale-105 hover:-translate-y-1 hover:scale-105";
              const recommendedBadge = card.querySelector(".recommended-badge");
              const selectedBadge = card.querySelector(".selected-badge");
              if (recommendedBadge) recommendedBadge.classList.add("hidden");
              if (selectedBadge) selectedBadge.classList.remove("hidden");
              registerBtn.className =
                "w-full bg-gold-gradient text-white py-3 px-4 rounded-lg font-medium hover:bg-dark-gold focus:outline-none focus:ring-2 focus:ring-gold focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed";
            } else if (card.classList.contains("plan-platinum")) {
              card.className =
                "plan-card plan-platinum active rounded-lg p-6 text-center transition-all duration-300 relative cursor-pointer border-[3px] border-slate-500 bg-platinum-gradient shadow-[0_6px_20px_rgba(113,128,150,0.4),0_0_0_6px_rgba(113,128,150,0.15)] -translate-y-1 scale-105 hover:-translate-y-1 hover:scale-105 animate-[platinumShine_10s_ease-in-out_infinite] bg-[length:200%_200%]";
              const selectedBadge = card.querySelector(".selected-badge");
              if (selectedBadge) selectedBadge.classList.remove("hidden");
              registerBtn.className =
                "w-full bg-platinum-gradient-dark text-white py-3 px-4 rounded-lg font-medium hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed";
            }
          });
        });
      }
    </script>
  </body>
</html>
